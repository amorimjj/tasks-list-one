<ul class="header">
    <li>Changelist / Build</li>
    <li>Owner</li>
    <li class="show-time">Time Started</li>
    <li>State</li>
    <li>Metrics</li>
    <li>Build</li>
    <li>Unit Test</li>
    <li>Functional Test</li>
</ul>
<ul class="items">
    <li ng-class="task.state" ng-repeat="task in tasks | orderBy:'-changelist'" ng-click="toggleSelection(task)">
        <div class="item">
            <div>
                <img tone-type-icon type="task.type" state="task.state" />
                <small>{{ task.type == 'firewall' ? task.changelist : task.owner }}</small>
            </div>
            <div><small ng-if="task.type == 'firewall'">{{ task.owner }}</small></div>
            <div class="show-time">{{ task.startedAt | date : 'd/M/yyyy h:mma' }}</div>
            <div class="state">{{ task.state }}</div>
            <div class="steps" ng-class="{ expanded: task.selected }">
                <div tone-step-state state="task.metrics.state" progress="task.metrics.progress"></div>
                <div tone-step-state state="task.buid.state" progress="task.buid.progress"></div>
                <div tone-step-state state="task.unitTest.state" progress="task.unitTest.progress"></div>
                <div tone-step-state state="task.funcionalTest.state" progress="task.funcionalTest.progress"></div>
            </div>
        </div>
        <div class="details" ng-if="task.selected">
            <div class="step-info" ng-class="task.metrics.state">
                <h5>Metrics</h5>
                <div tone-metric-box type="'test'" length="task.metrics.test"></div>
                <div tone-metric-box type="'maintainability'" length="task.metrics.maintainability"></div>
                <div tone-metric-box type="'security'" length="task.metrics.security"></div>
                <div tone-metric-box type="'workmanship'" length="task.metrics.workmanship"></div>
            </div>
            <div class="step-info" ng-class="task.buid.state">
                <h5>Build</h5>
                <div class="computer"><img src="images/computer.png" alt="Debug">Debug</div>
                <div class="computer"><img src="images/computer.png" alt="Release">Release</div>
                <div class="show-time">{{ task.buid.startedAt | date : 'h:mma d/M/yyyy' }}</div>
            </div>
            <div class="step-info" ng-class="task.unitTest.state">
                <h5>Unit Test</h5>
                <tone-tests-result results="task.unitTest"></tone-tests-result>
            </div>
            <div class="step-info" ng-class="task.funcionalTest.state">
                <h5>Functional Test</h5>
                <tone-tests-result results="task.funcionalTest"></tone-tests-result>
            </div>
            <div class="result" ng-class="task.result.state" ng-click="$event.stopPropagation();">
                <h5>Result:</h5>
                <div class="message">
                    <span ng-if="task.result.state == 'accepted'">Change accepted</span>
                    <span ng-if="task.result.state == 'rejected'">Change rejected</span>
                    {{task.result.message}}
                </div>
                <div ng-if="task.result.state == 'accepted'" class="action search-icon">
                    <button>Merged Build</button>
                </div>
                <div ng-if="task.result.state == 'rejected'" class="action">
                    <button>Find Issues</button>
                </div>
                <div ng-if="task.result.state == 'complete'" class="action">
                    <button>Deploy</button> to:
                    <div class="select">
                        <select ng-model="deployTarget" ng-options="option as option for option in deployOptions"></select>
                    </div>
                </div>
            </div>
        </div>
    </li>
</ul>
